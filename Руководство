Руководство по развертыванию Apache Airflow и настройке его компонентов
Данное руководство описывает шаги для установки и настройки Apache Airflow, а также интеграции с внешними компонентами, такими как OpenWeatherMap API. Четко следуйте этим инструкциям, и вы сможете успешно развернуть и настроить Airflow в своей среде.

1. Подготовка среды
1.1 Проверка установленных программ
    • Убедитесь, что у вас установлен Python (рекомендуется версия 3.6 или выше).
    • Убедитесь, что установлен пакетный менеджер pip.
python --version
pip --version

1.2 Установка Apache Airflow
    • Установите Apache Airflow и необходимые зависимости (например, для PostgreSQL) с помощью следующей команды:
pip install apache-airflow[postgres]
Замените [postgres] на нужный вам бэкенд, если вы используете другой (например, [mysql] или оставьте пустым для использования SQLite).

2. Настройка конфигурационного файла
2.1 Создание файла airflow.cfg
    • Apache Airflow создает файл конфигурации airflow.cfg, который будет находиться в директории AIRFLOW_HOME (по умолчанию это ~/airflow).
    • Вы можете настроить следующие параметры в этом файле:
        ◦ executor: выберите подходящий исполнитель (LocalExecutor, SequentialExecutor или CeleryExecutor).
        ◦ строка соединения с вашей базой данных.
        ◦ Другие параметры, касающиеся логирования, планирования и приложения.

3. Инициализация базы данных
    • После настройки конфигурационного файла выполните команду для инициализации метаданных базы данных:
airflow db init

4. Создание пользователя (если необходимо)
    • Создайте пользователя admin, чтобы иметь доступ к веб-интерфейсу Airflow:
airflow users create --username admin --firstname Admin --lastname User --role Admin --email admin@example.com --password admin_password

5. Создание DAG
    • Сохраните ваши файлы DAG (например, weather_dag.py) в директории dags, которая находится в вашей AIRFLOW_HOME директории.

6. Запуск Airflow
6.1 Запуск веб-сервера
    • В отдельной консоли запустите веб-сервер:
airflow webserver --port 8080

6.2 Запуск планировщика
    • Также в отдельной консоли запустите планировщик:
airflow scheduler
Теперь вы сможете получить доступ к веб-интерфейсу Airflow по адресу http://localhost:8080 и увидеть ваши DAG.

. Настройка окружения и подключение сторонних библиотек
    • Убедитесь, что все необходимые библиотеки установлены (например, requests, pandas, pyarrow, и другие):
pip install requests pandas pyarrow fastparquet
Если вы используете Docker, рассмотрите возможность создания собственного Dockerfile для настройки окружения с необходимыми библиотеками.

8. Подключение к API
8.1 Настройка API
    • Убедитесь, что ваш код согласуется с API, который вы используете (например, OpenWeatherMap).
    • Проверьте корректность API ключей и других данных для подключения.
9. Мониторинг и отладка
    • Используйте веб-интерфейс Airflow для мониторинга выполнения ваших DAG и задач.
    • Просматривайте журналы каждой задачи, чтобы выявить ошибки или проблемы, возникающие при выполнении.